import "tfplan-functions" as plan

forbidden_cidrs = ["0.0.0.0/0"]

allFirewalls = plan.find_resources("google_compute_firewall")

egressFirewalls = plan.filter_attribute_is_value(allFirewalls,
                        "direction", "EGRESS", false).resources

violatingFirewalls = plan.filter_attribute_contains_items_from_list(
                     egressFirewalls, "destination_ranges", forbidden_cidrs, true)

violations = length(violatingFirewalls["messages"])

main = rule {
  violations is 0
}